### item66 네이티브 메서드는 신중히 사용하라

- 자바 네이티브 인터페이스(JNI)는 자바 프로그램이 네이티브 메서드를 호출하는 기술이다. 여기서 `네이티브 메서드란 C나 C++같은 외부 프로그래밍 언어로 작성한 메서드를 말한다.`(네이티브 메서드를 사용할 때는 native 키워드를 이용한다.) 전통적으로 네이티브 메서드의 주요 쓰임은 총 세 가지이다.

```
1. 레지스트리 같은 플랫폼 특화 기능을 사용한다.
2. 네이티브 코드로 작성된 기존 라이브러리를 사용한다.
레거시 데이터를 사용하는 레거시 라이브러기가 대표적인 예이다. -> 레거시 데이터란 번역하면 오래된 데이터이다. 즉, 예전에 작성한 코드에서 사용하는 데이터들을 의미한다.
3. 성능 개선을 목적으로 성능에 결정적인 영향을 주는 영역만 따로 네이티브 언어로 작성한다.
```

- 다음은 실제 네이티브 메서드를 쓰는 예시이다.

```java
public class Thread implements Runnable {
...
 public synchronized void start() {
           if (threadStatus != 0)
            throw new IllegalThreadStateException();

        group.add(this);

        boolean started = false;
        try {
            start0();
            started = true;
        } finally {
            try {
                if (!started) {
                    group.threadStartFailed(this);
                }
            } catch (Throwable ignore) {
            }
        }
    }

    private native void start0();
 ...
}
```

- 과거에는 위와 같은 이유로 네이티브 메서드를 사용했지만, 최근엔 자바가 크게 발전하면서 네이티브 메서드를 거의 사용하지 않고 성능적인 면에서도 오히려 자바의 라이브러리들이 고성능인 경우도 많다. 그래서 특히, 성능을 개선할 목적으로 네이티브 메서드를 사용하는 것은 거의 권장하지 않는다.
- 이러한 예시로는 BigInteger가 있다. java.math가 처음 추가된 자바 1.1시절에는 C로 작성한 고성능 라이브러리에 의존했다. 그러다 자바 3 때 순수 자바로 다시 구현되면서 세심한 튜닝한 결과, 원래의 네이티브 구현보다도 더 빨라졌다.
- 네이티브 메서드에는 심각한 단점도 있다.

```
1. 네이티브 언어가 안전하지 않으므로(아이템50) 네이티브 메서드를 사용하는 애플리케이션더 메모리 훼손이 오류로부터 더 이상 안전하지 않다.
2. 네이티브 언어는 자바보다 플랫폼을 많이 타서 이식성도 낮다.
3. 디버깅도 더 어렵다. 주의하지 않으면 속도가 오히려 느려질 수도 있다.
4. 가비지 컬렉터가 네이티브 메모리는 자동 회수하지 못하고, 심지어 추적조차 할 수 없다(아이템8).
5. 자바 코드와 네이티브 코드의 경계를 넘나들 때마다 비용도 추가된다.
6. 네이티브 메서드와 자바 코드 사이의 '접착 코드'를 작성해야 하는데, 이는 귀찮은 작업이고 가독성도 떨어진다.
```

- 한편, 네이티브 라이브러리 쪽은 GNU 다중 정밀 연산 라이브러리(GMP)를 필두로 개선 작업이 계속돼왔다. 그래서 정말로 고성능의 다중 정밀 연산이 필요한 자바 프로그래머라면 네이티브 메서드를 통해 GMP를 사용하는 걸 고려해도 좋다.

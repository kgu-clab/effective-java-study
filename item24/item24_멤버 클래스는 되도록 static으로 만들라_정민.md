# item 24

### 멤버 클래스는 되도록 static으로 만들라

- 중첩 클래스란

:다른 클래스 안에 정의된 클래스

특징1) 자신을 감싼 바깥 클래스에서만 사용되어야 함

→그 이외의 쓰임새로 사용 시 해당 클래스를 톱레벨 클래스로 만들어야 함

특징 2) 종류로는 **정적 멤버 클래스, (비정적) 멤버 클래스, 익명 클래스, 지역 클래스**가 있음

- 정적 멤버 클래스

특징 1) 다른 클래스 안에 선언됨

특징 2) 바깥 클래스의 private 멤버에도 접근할 수 있음

특징3) 다른 정적 멤버와 똑같은 접근 규칙을 적용 받음

→ 특정 정적 멤버 클래스의 접근 지정자를 private으로 할 시, 바깥 클래스에서만 접근할 수 있음

- 정적 멤버 클래스는 “바깥 클래스와 함께 쓰일 때만 유용한 public 도우미 클래스”

예제) Operation 열거 타입은 Calculator 클래스의 public 정적 멤버 클래스가 되어야 함.

→즉, Calculator 라는 바깥 클래스에 Operation이라는 public 정적 멤버 클래스를 선언하게 되면 외부에서 해당 멤버에 접근 시 ‘Calculator.Operation.PLUS’, ‘Calculator.Operation.MINUS’와 같은 형태로 접근할 수 있어서 **Calculator 소속을 명확하게 확인할 수 있음**


- 정적 멤버 클래스와 비정적 멤버 클래스의 차이

-**구문상 차이**: static 유무

-**의미상 차이**:정적 멤버 클래스는 바깥 클래스의 인스턴스와 무관한 반면,  비정적 멤버 클래스의 인스턴스는 바깥 클래스의 인스턴스와 암묵적으로 연결됨

→비정적 멤버 클래스에서 **정규화된 this** 키워드를 통해 바깥 인스턴스의 메서드를 호출하거나 바깥 인스턴스를 참조할 수 있음

***정규화된 this: ‘클래스명.this’ 형태**

→중첩 클래스의 인스턴스가 바깥 인스턴스와 독립적으로 존재할 수 있다면 **‘정적 멤버 클래스’**,

→바깥 인스턴스 없이는 생성할 수 없다면 **‘비정적 멤버 클래스’**

- 비정적 멤버 클래스의 인스턴스와 바깥 인스턴스 사이의 관계

  : 비정적 멤버 클래스가 인스턴스화 될 때 확립되며, 변경 불가능

**→이 관계 정보는 비정적 멤버 클래스의 인스턴스 안에 만들어져 메모리 공간을 차지하며 생성시간도 더 걸림**

- 비정적 멤버 클래스의 쓰임새

  : 어댑터를 정의할 때 자주 사용됨 → 어떤 클래스의 인스턴스를 감싸 마치 다른 클래스의 인스턴스처럼 보이게 하는 뷰로 사용

예제) Set, List와 같은 컬렉션 인터페이스 구현에서 자신의 반복자를 구현할 때 비정적 멤버 클래스를 사용함

```java
public class MySet<E> extends AbstractSet<E> { 
    // 생략
@Override public Iterator<E> iterator() {
return new Mylterator();
}
private class MyIterator implements Iterator<E> {
}
}
```

→MyIterator은 MySet 안에 존재하는 비정적 멤버 클래스로 iterator()를 통해 MyIterator 클래스의 인스턴스를 생성해 반환함

→즉,MyIterator 클래스(비정적 멤버 클래스)는 Myset(바깥 클래스)의 인스턴스에 자동으로 연결되어 MySet 필드에 직접 접근할 수 있음

- **바깥 인스턴스에 접근할 일이 없다면 무조건 static을 붙여서 정적 멤버 클래스로 만들자**

이유1: static을 생략하면 바깥 인스턴스로의 숨은 외부 참조를 갖게 됨→ 시간과 공간이 소비됨

이유2: 가비지 컬렉션이 바깥 클래스의 인스턴스를 수거하지 못하는 메모리 누수가 생길 수 있음

즉, 참조가 눈에 보이지 않아 문제의 원인을 찾기도 어려워 심각한 상황을 초래할 수도 있음

- 이유 1에 대한 예제

  : 키와 값을 매핑시키는 Map 인스턴스

→Map 구현체는 키-값 쌍을 표현하는 엔트리 객체를 가지고 있음.

→모든 엔트리가 Map과 연관되어 있지만 엔트리의 메서드들이 Map을 직접 사용하지는 않음

(바깥 인스턴스에 접근할 일이 없음)

따라서, 엔트리를 비정적 멤버 클래스로 표현하는 것은 시간과 공간 낭비

- 익명 클래스의 개념과 특징

:이름이 없는 클래스

특징1) 쓰이는 시점에 선언과 동시에 인스턴스가 만들어짐

특징2) 코드의 어디서든 만들 수 있음

특징3) 오직 비정적인 문맥에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있음

특징4) 상수 변수 이외의 정적 멤버는 가질 수 없음

(상수표현을 위해 초기화된 final 기본타입과 문자열 필드만 가질 수 있음)

- 익명 클래스의 제약

제약1) 선언한 지점에서만 인스턴스를 만들 수 있음

제약2) instanceof 검사(객체 타입 확인 시)나 클래스의 이름이 필요한 작업은 수행할 수 없음

제약3) 여러 인터페이스를 구현할 수 없으며 인터페이스를 구현하는 동시에 다른 클래스를 상속할 수 없음

제약4) 익명 클래스가 상위 타입에서 상속한 멤버 외에는 호출할 수 없음

제약5) 익명 클래스는 표현식 중간에 등장하므로 짧지 않으면 가독성이 떨어짐

- 익명 클래스의 쓰임새
1. 자바가 람다를 지원하기 전에 즉석에서 작은 함수 객체나 처리 객체를 만드는 데 주로 사용함
   *람다(lambda)는 익명 클래스보다 훨씬 짧고 읽기 쉬운 방식으로 코드를 작성할 수 있게 해주는 문법
2. 정적 팩터리 메서드를 구현할 때 사용함

- 지역 클래스

특징1 ) 지역변수를 선언할 수 있는 곳이면 어디서든 선언 가능

특징2 ) 유효 범위도 지역변수와 같음

특징3) 멤버 클래스처럼 이름이 있고 반복해서 사용할 수 있음

특징4 ) 익명 클래스처럼 비정적 문맥에서 사용될 때만 바깥 인스턴스를 참조할 수 있으며, 정적 멤버는 가질수 없고 가독성을 위해 짧게 작성해야 함